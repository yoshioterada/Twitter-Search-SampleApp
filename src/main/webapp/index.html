<!DOCTYPE html>

<html>
    <head>
        <title>WebSocket Twitter タイムライン</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style type="text/css">
            table,td,th { 
                width: 700px;
                font-size: medium;
                border-collapse: collapse; 
                border: 1px black solid; 
            }
        </style>

        <script language="javascript" type="text/javascript">
            var websocket = null;
            var numberOfMessage;

            function init() {
                numberOfMessage = 0;
                document.getElementById("update").style.display = "none";
                document.getElementById("close").style.display = "none";
            }

            function closeServerEndpoint() {
                websocket.send("stop");
                websocket.close(4001, "Close connection from client");
                document.getElementById("connect").style.display = "block";
                document.getElementById("close").style.display = "none";
                document.getElementById("update").style.display = "none";
            }
            
            

            function connectServerEndpoint() {
                var wsUri = "ws://yoshio3-jetty.azurewebsites.net/twitter";
                if ("WebSocket" in window) {
                    websocket = new WebSocket(wsUri);
                } else if ("MozWebSocket" in window) {
                    websocket = new MozWebSocket(wsUri);
                } else {
                    websocket = new WebSocket(wsUri);
                }


                websocket.onopen = function (evt) {
                    websocket.send("start");
                    onOpen(evt);
                };
                websocket.onmessage = function (evt) {
                    onMessage(evt);
                };
                websocket.onerror = function (evt) {
                    onError(evt);
                };
                websocket.onclose = function (evt) {
                    closeServerEndpoint();
                };
                document.getElementById("connect").style.display = "none";
                document.getElementById("close").style.display = "block";
                document.getElementById("update").style.display = "block";

    }

            function onOpen(evt) {
                ;
            }

            function onMessage(evt) {
                writeToScreen(evt.data);
                numberOfMessage++;
            }

            function onError(evt) {
                writeToScreen("ERROR: " + evt.data);
            }

            function writeToScreen(messages) {
                var table = document.getElementById("TBL");
                var row = table.insertRow(0);
                var cell1 = row.insertCell(0);
                cell1.style.color = "WHITE";

                var textNode = document.createTextNode(messages);

                var z = numberOfMessage % 2;
                if (z == 1) {
                    cell1.style.backgroundColor = "#669900";
                } else {
                    cell1.style.backgroundColor = "#ED9B09";
                }
                cell1.appendChild(textNode);
            }

            window.addEventListener("load", init, false);
        </script>
    </head>
    <body>
        <h2>Twitter ツイート検索</h2>
        <input id="connect" type="button" value="Connect" onClick="connectServerEndpoint();">
        <input id="close" type="button" value="DisConnect" onClick="closeServerEndpoint();">
        <br/>
        <TABLE BORDER="1" ID="TBL">            
        </TABLE>
    </body>
</html>